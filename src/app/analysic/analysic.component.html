<app-navigation></app-navigation>

<section class="analytics-page">
  <mat-card class="mat-elevation-z4 p-4">
    <h2 class="page-title">Sales Analytics</h2>

    <!-- Analytics Overview Cards -->
    <div class="analytics-cards">
      <mat-card class="mat-elevation-z3 card">
        <mat-icon class="card-icon">attach_money</mat-icon>
        <strong>Total Sales:</strong>
        <div class="card-value">{{ totalSales | currency }}</div>
      </mat-card>

      <mat-card class="mat-elevation-z3 card">
        <mat-icon class="card-icon">show_chart</mat-icon>
        <strong>Total Profit:</strong>
        <div class="card-value">{{ totalProfit | currency }}</div>
      </mat-card>

      <mat-card class="mat-elevation-z3 card">
        <mat-icon class="card-icon">package</mat-icon>
        <strong>Items Sold:</strong>
        <div class="card-value">{{ totalItems }}</div>
      </mat-card>

      <mat-card class="mat-elevation-z3 card">
        <mat-icon class="card-icon">people</mat-icon>
        <strong>Unique Clients:</strong>
        <div class="card-value">{{ uniqueClientsCount }}</div>
      </mat-card>

      <mat-card class="mat-elevation-z3 card">
        <mat-icon class="card-icon">local_shipping</mat-icon>
        <strong>Total Delivery Cost:</strong>
        <div class="card-value">{{ totalDeliveryCost | currency }}</div>
      </mat-card>

      <mat-card class="mat-elevation-z3 card">
        <mat-icon class="card-icon">receipt</mat-icon>
        <strong>Total Tax Cost:</strong>
        <div class="card-value">{{ totalTaxCost | currency }}</div>
      </mat-card>

      <mat-card class="mat-elevation-z3 card">
        <mat-icon class="card-icon">hourglass_empty</mat-icon>
        <strong>Pending Orders:</strong>
        <div class="card-value">{{ pendingCount }}</div>
      </mat-card>

      <mat-card class="mat-elevation-z3 card">
        <mat-icon class="card-icon">check_circle</mat-icon>
        <strong>Completed Orders:</strong>
        <div class="card-value">{{ doneCount }}</div>
      </mat-card>
    </div>

    <!-- Filter Options -->
    <div class="filter-options">
      <mat-button-toggle-group name="status" aria-label="Order Status Filter" [(ngModel)]="statusFilter" (change)="filterByStatus(statusFilter)">
        <mat-button-toggle value="Pending">Show Pending</mat-button-toggle>
        <mat-button-toggle value="Done">Show Completed</mat-button-toggle>
        <mat-button-toggle value="All">Show All</mat-button-toggle>
      </mat-button-toggle-group>
    </div>

    <!-- Filtered Sales Table -->
    <div *ngIf="filteredSalesData.length > 0">
      <mat-card class="mat-elevation-z4 p-4">
        <table mat-table [dataSource]="filteredSalesData" class="mat-elevation-z2 full-width-table">

          <ng-container matColumnDef="client">
            <th mat-header-cell *matHeaderCellDef> Client </th>
            <td mat-cell *matCellDef="let element"> {{ element.client }} </td>
          </ng-container>

          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef> Quantity </th>
            <td mat-cell *matCellDef="let element"> {{ element.quantity }} </td>
          </ng-container>

          <ng-container matColumnDef="cost">
            <th mat-header-cell *matHeaderCellDef> Cost </th>
            <td mat-cell *matCellDef="let element"> {{ element.cost | currency }} </td>
          </ng-container>

          <ng-container matColumnDef="discount">
            <th mat-header-cell *matHeaderCellDef> Discount (%) </th>
            <td mat-cell *matCellDef="let element"> {{ element.discount }} </td>
          </ng-container>

          <ng-container matColumnDef="shippingCost">
            <th mat-header-cell *matHeaderCellDef> Shipping </th>
            <td mat-cell *matCellDef="let element"> {{ element.shippingCost | currency }} </td>
          </ng-container>

          <ng-container matColumnDef="tax">
            <th mat-header-cell *matHeaderCellDef> Tax </th>
            <td mat-cell *matCellDef="let element"> {{ element.tax | currency }} </td>
          </ng-container>

          <ng-container matColumnDef="profit">
            <th mat-header-cell *matHeaderCellDef> Profit </th>
            <td mat-cell *matCellDef="let element"> {{ calculateProfit(element) | currency }} </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef> Actions </th>
            <td mat-cell *matCellDef="let element">
              <button mat-icon-button (click)="onClean(filteredSalesData.indexOf(element))">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['client', 'quantity', 'cost', 'discount', 'shippingCost', 'tax', 'profit', 'actions']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['client', 'quantity', 'cost', 'discount', 'shippingCost', 'tax', 'profit', 'actions'];"></tr>
        </table>
      </mat-card>
    </div>

    <!-- No Data Template -->
    <ng-template #noData>
      <mat-card class="mat-elevation-z3 p-4">
        <p class="no-data-msg">ðŸš« No sales data available.</p>
      </mat-card>
    </ng-template>
  </mat-card>
</section>
